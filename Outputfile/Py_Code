import gradio as gr
from PyPDF2 import PdfReader
from transformers import AutoTokenizer, AutoModelForCausalLM

# 1. Load a small open model
model_name = "microsoft/phi-2"   # ~2.7B params, runs on CPU
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name)

# 2. Function to simplify text
def simplify_report(pdf_file):
    # Read text from PDF
    reader = PdfReader(pdf_file.name)
    text = "".join([page.extract_text() for page in reader.pages])

    # Prompt the model
    prompt = f"Explain this medical report in simple, patient-friendly language:\n\n{text}\n\nSimplified Explanation:"

    inputs = tokenizer(prompt, return_tensors="pt")
    outputs = model.generate(**inputs, max_new_tokens=250)
    result = tokenizer.decode(outputs[0], skip_special_tokens=True)
    return result

# 3. Build Gradio interface
demo = gr.Interface(
    fn=simplify_report,
    inputs=gr.File(label="Upload Medical Report (PDF)"),
    outputs="text",
    title="ðŸ©º Explain My Report",
    description="Upload a medical report to get a simple explanation anyone can understand."
)

# 4. Launch app
demo.launch()
